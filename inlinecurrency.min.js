var rates={},currencies=["AUD","BGN","BRL","CAD","CHF","CNY","CZK","DKK","EUR","GBP","HKD","HRK","HUF","IDR","ILS","INR","JPY","KRW","MXN","MYR","NOK","NZD","PHP","PLN","RON","RUB","SEK","SGD","THB","TRY","USD","ZAR"],valueRegex=/(^|\W)([A-Za-z]{3})\s?(\d+(\.\d{2})?)(-(\d+(\.\d{2})?))?($|\W)/im,classRegex=/([A-Za-z]{3}\d+(\.\d{2})?(-\d+(\.\d{2})?)?)/gim,currencyClass="currency",elementQuery="."+currencyClass,targetCurr="EUR",ddmIdStr="currencyDDM",ddmClassStr="currencyDDM",apiURL="http://api.fixer.io/latest?base=",markTextWithClass=function(e,t){var r=getTextNodesIn(jQuery("body"));r.replaceWith(function(){var r=jQuery(this)[0].textContent;return r.replace(e,'<span class="'+t+'">$1</span>')})},getRates=function(e,t){e=e.toUpperCase(),jQuery.getJSON(apiURL+e,function(r){var n;e in rates?n=rates[e]:(n={},rates[e]=n),jQuery.extend(n,r.rates),jQuery.each(r.rates,function(t,r){t in rates||(rates[t]={}),rates[t][e]=1/r}),t&&jQuery(elementQuery).each(convertElement(e))})},convertElement=function(e){return e=e.toUpperCase(),function(t){var r=jQuery(this).text(),n=valueRegex.exec(r),a=n[2].toUpperCase(),s=parseFloat(n[3]),i=n[6]?!0:!1,u=i?parseFloat(n[6]):void 0,c=0;if(a!==e&&a in rates&&e in rates[a]&&(c=rates[a][e]),r=a+" "+n[3],i&&(r+="-"+n[6]),c){var o=s*c;if(r+=" ("+e+" "+o.toFixed(2),i){var d=u*c;r+="-"+d.toFixed(2)}r+=")"}jQuery(this).html(r)}},getTextNodesIn=function(e){return jQuery(e).find(":not(iframe)").addBack().contents().filter(function(){return 3===this.nodeType})},initDropDownMenu=function(e,t,r,n,a){n||(n=targetCurr),a||(a=currencies),html='<select id="'+t+'" class="'+r+'">';for(var s=0;s<a.length;s++)html+='<option value="'+a[s]+'"'+(n===a[s]?' selected="selected"':"")+">"+a[s]+"</option>";html+="</select>",jQuery(html).on("change",function(){targetCurr=jQuery(this).val(),getRates(targetCurr,!0)}).appendTo(e)};jQuery(function(){markTextWithClass(classRegex,currencyClass),getRates(targetCurr,!0),initDropDownMenu(jQuery("#ddmContainer"),ddmIdStr,ddmClassStr)});